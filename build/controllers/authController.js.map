{"version":3,"sources":["../../src/controllers/authController.js"],"names":[],"mappings":"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","file":"authController.js","sourcesContent":["import passport from 'passport';\nimport jwt from 'jsonwebtoken';\nimport moment from 'moment';\n\nexport const loginAuth = (req, res, next) => {\n  passport.authenticate('local-login', function(err, user, info) { \n    console.log('error : ',err);\n    console.log('info : ',info);\n    console.log('user : ',user);\n    if (err) { return next(err); }\n    if (!user) { \n      res.status(401);\n      res.json({\n        \"status\": 401,\n        \"message\": \"Invalid credentials\"\n      });\n      return;\n      //return res.redirect('/login'); \n    }\n    req.logIn(user, function(err) {\n        if (err) { return next(err); }\n        return res.json({\n          token:genToken(user),\n          username:user.local.email\n        });\n    });\n  })(req, res, next);\n}\n\nexport const signupAuth = (req, res, next) => {\n  passport.authenticate('local-signup', (err, user, info) => { \n    console.log(err);\n    console.log(info);\n    console.log(user);\n    if (err) { return next(err); }\n    if (!user) {\n      res.status(401);\n      res.json({\n        \"status\": 401,\n        \"message\": \"Signup Failed\"\n      });\n      return;\n    }\n    req.logIn(user, function(err) {\n        if (err) { return next(err); }\n        return res.json(genToken(user));\n    });\n  })(req, res, next);\n}\n\nexport const chromeAuth = (req, res, next) => {\n  passport.authenticate('local-login', function(err, user, info) { \n    console.log(err);\n    console.log(info);\n    console.log(user);\n    if (err) { return next(err); }\n    if (!user) { \n      res.json({\n        login: 'failed'\n      });\n      return false;\n    }\n    req.logIn(user, (err) => {\n        console.log('user',user.local.email);\n        if (err) { return next(err); }\n        return res.json({\n          login: 'success'\n        });\n    });\n  })(req, res, next);\n}\n\n// private method\nconst genToken = (user) => {\n  var payload = {\n    iss: 'my.domain.com',\n    sub: user.id,\n    iat: moment().unix(),\n    exp: moment().add(1, 'days').unix()\n  };\n  return jwt.sign(payload, process.env.TOKEN_SECRET);\n}\n"]}