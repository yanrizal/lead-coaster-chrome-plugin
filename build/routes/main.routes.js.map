{"version":3,"sources":["../../src/routes/main.routes.js"],"names":[],"mappings":"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","file":"main.routes.js","sourcesContent":["import express from 'express';\nimport bodyParser from 'body-parser';\nimport request from 'request';\nimport cheerio from 'cheerio';\nimport Crawler from 'simplecrawler';\nimport querystring from 'querystring';\nimport fs from 'fs';\nimport chalk from 'chalk';\nimport passport from 'passport';\nimport { saveFile, findFile, addFile } from '../models/file';\n\n// const clientID = '759dlh2okqws42';\n// const clientSecret = 'OnnN8xW3X5zecdei';\n// const proxy = 'http://101.96.10.30:84';\n// const agent = new HttpsProxyAgent(proxy);\n\n// const router = express.Router();\nconst jsonParser = bodyParser.json();\n\n// app/routes.js\nmodule.exports = function(app, passport) {\n\n    app.get('/', function(req, res) {\n      let user = (req.user ? true : false);\n      let email = (req.user ? req.user.local.email : '');\n      res.render('index', { title: 'index', user: user, email: email });\n    });\n\n    app.post('/post/url', jsonParser, (req, res) => {\n      const params = {\n        url: req.body.url\n      };\n      console.log(params.url);\n      const outputFilename = 'tmp/mysearch.json';\n\n      fs.writeFile(outputFilename, JSON.stringify(params, null, 4), function(err) {\n          if(err) {\n            console.log(err);\n          } else {\n            console.log(\"JSON saved to \" + outputFilename);\n          }\n      });\n      res.json(params.url);\n    });\n\n    app.post('/savedata', jsonParser, (req, res) => {\n      const params = {\n        data:[{\n          username: req.body.lkdUsername,\n          urlSearch: req.body.urlSearch,\n          totalSearch: req.body.totalSearch,\n          profileVisit: req.body.dataProfile\n        }],\n        meta:{\n          lastPage: req.body.page\n        }\n      };\n      saveFile(params, (err, response) => {\n        console.log(response);\n        res.json(response);\n      });\n    });\n\n    app.post('/getdata', jsonParser, (req, res) => {\n      const params = {\n        username: req.body.lkdUsername\n      };\n      findFile(params, (err, response) => {\n        console.log(response);\n        res.json(response);\n      });\n    });\n\n    app.post('/adddata', jsonParser, (req, res) => {\n      const params = {\n        profileVisit: [],\n        totalSearch: 0,\n        urlSearch: req.body.urlSearch,\n        username: req.body.username,\n        searchName: req.body.searchName\n      };\n      addFile(params, (err, response) => {\n        console.log(response);\n        res.json(response);\n      });\n    });\n\n\n    app.get('/login', function(req, res) {\n      let user = (req.user ? true : false);\n      res.render('index', { title: 'login', user: user });\n    });\n\n    // process the login form\n    app.post('/login', function(req, res, next) {\n      passport.authenticate('local-login', function(err, user, info) { \n        console.log(err);\n        console.log(info);\n        console.log(user);\n        if (err) { return next(err); }\n        if (!user) { return res.redirect('/login'); }\n        req.logIn(user, function(err) {\n            if (err) { return next(err); }\n            return res.json({detail: info});\n        });\n      })(req, res, next);\n    });\n\n    app.post('/login-chrome', function(req, res, next) {\n      passport.authenticate('local-login', function(err, user, info) { \n        console.log(err);\n        console.log(info);\n        console.log(user);\n        if (err) { return next(err); }\n        if (!user) { \n          res.json({\n            data: []\n          });\n          return false;\n        }\n        req.logIn(user, function(err) {\n            console.log('user',user.local.email);\n            if (err) { return next(err); }\n            const params = {\n              username: user.local.email\n            } \n            findFile(params, (err, response) => {\n              console.log(response);\n              res.json(response);\n            });\n        });\n      })(req, res, next);\n    });\n\n    app.get('/signup', function(req, res) {\n      let user = (req.user ? true : false);\n      res.render('index', { title: 'signup', user: user });\n    });\n\n    app.post('/signup', function(req, res, next) {\n      passport.authenticate('local-signup', function(err, user, info) { \n        console.log(err);\n        console.log(info);\n        console.log(user);\n        if (err) { return next(err); }\n        if (!user) { return res.redirect('/login'); }\n        req.logIn(user, function(err) {\n            if (err) { return next(err); }\n            return res.json({detail: info});\n        });\n      })(req, res, next);\n    });\n\n    app.get('/help', isLoggedIn, function(req, res) {\n      console.log(req.user);\n      let user = (req.user ? true : false);\n      let email = (req.user ? req.user.local.email : '');\n      res.render('index', { title: 'Help', user: user, email: email });\n    });\n\n    app.get('/result', isLoggedIn, function(req, res) {\n      console.log(req.user);\n      let user = (req.user ? true : false);\n      let email = (req.user ? req.user.local.email : '');\n      res.render('index', { title: 'Result', user: user, email: email });\n    });\n\n    app.get('/coaster/active', isLoggedIn, function(req, res) {\n      console.log(req.user);\n      let user = (req.user ? true : false);\n      let email = (req.user ? req.user.local.email : '');\n      res.render('index', { title: 'Coaster Active', user: user, email: email });\n    });\n\n    app.post('/coaster/api', jsonParser, (req, res) => {\n      const params = {\n        email: req.body.email\n      };\n      let obj;\n      const file = 'tmp/data-'+params.email+'.json';\n      fs.readFile(file, 'utf8', function (err, data) {\n        if (err) throw err;\n        obj = JSON.parse(data);\n        res.json(obj);\n      });\n    });\n\n    app.get('/logout', function(req, res) {\n        req.logout();\n        res.redirect('/');\n    });\n};\n\n// route middleware to make sure a user is logged in\nfunction isLoggedIn(req, res, next) {\n\n    // if user is authenticated in the session, carry on \n    if (req.isAuthenticated())\n        return next();\n\n    // if they aren't redirect them to the home page\n    res.redirect('/');\n}\n\n\n\n\n"]}